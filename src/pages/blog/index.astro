---
import Layout from '../../layouts/Layout.astro';
import { formatDate } from '../../utils';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => import.meta.env.DEV || !data.draft);
const posts = allPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<Layout title="Blog | Peter Son" description="Thoughts on front-end development, web technologies, and the latest trends in the industry.">
    <main class="py-16 sm:py-24 lg:py-32">
        <div class="max-w-4xl mx-auto px-6 sm:px-8">
            <div class="text-center mb-16">
                <h1 class="text-4xl sm:text-5xl lg:text-6xl font-bold text-navy mb-6">Blog</h1>
                <p class="text-lg sm:text-xl text-navy max-w-2xl mx-auto">
                    Thoughts on front-end development, web technologies, and the latest trends in the industry.
                </p>
            </div>

            <ul class="space-y-12">
                {
                    posts.map(({ slug, data }) => (
                        <li class="group">
                            <article class="bg-white rounded-md shadow-lg hover:shadow-xl transition-all duration-300 p-8">
                                <a href={`/blog/${slug}/`} class="block">
                                    <div class="flex flex-col lg:flex-row lg:items-start gap-6">
                                        {data.cover && (
                                            <div class="flex-shrink-0 lg:w-48">
                                                <img
                                                    src={data.cover}
                                                    alt={data.title}
                                                    loading="lazy"
                                                    class="w-full h-32 lg:h-24 object-cover rounded-md group-hover:scale-105 transition-transform duration-300"
                                                />
                                            </div>
                                        )}
                                        <div class="flex-1">
                                            <h2 class="text-2xl font-semibold text-navy mb-3 group-hover:text-sky transition-colors duration-200">
                                                {data.title}
                                            </h2>
                                            <p class="text-gray-600 mb-4 leading-relaxed">{data.description}</p>
                                            <div class="flex items-center justify-between">
                                                <time class="text-sm text-gray-500">{formatDate(data.pubDate)}</time>
                                                {data.tags?.length ? (
                                                    <div class="flex flex-wrap gap-2">
                                                        {data.tags.slice(0, 3).map((t) => (
                                                            <a
                                                                href={`/blog/tags/${t}/`}
                                                                class="px-3 py-1 bg-sky/10 text-sky text-xs rounded-full hover:bg-sky/20 transition-colors duration-200"
                                                            >
                                                                #{t}
                                                            </a>
                                                        ))}
                                                    </div>
                                                ) : null}
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            </article>
                        </li>
                    ))
                }
            </ul>
        </div>
    </main>
</Layout>
