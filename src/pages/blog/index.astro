---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => import.meta.env.DEV || !data.draft);
const posts = allPosts.sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
---

<Layout title="Blog" description="Notes on front-end and Astro">
    <main class="mx-auto max-w-3xl px-4 py-10">
        <h1 class="text-3xl font-semibold mb-6">Blog</h1>
        <ul class="space-y-8">
            {
                posts.map(({ slug, data }) => (
                    <li>
                        <a href={`/blog/${slug}/`} class="block group">
                            <h2 class="text-xl font-medium group-hover:underline">{data.title}</h2>
                            <p class="text-sm opacity-80">{data.description}</p>
                            <p class="text-xs mt-1">{data.pubDate.toLocaleDateString()}</p>
                        </a>
                        {data.tags?.length ? (
                            <ul class="mt-2 flex flex-wrap gap-2 text-xs">
                                {data.tags.map((t) => (
                                    <li>
                                        <a
                                            href={`/blog/tags/${t}/`}
                                            class="px-2 py-1 rounded-full bg-white/10 hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-white/60"
                                        >
                                            #{t}
                                        </a>
                                    </li>
                                ))}
                            </ul>
                        ) : null}
                    </li>
                ))
            }
        </ul>
    </main>
</Layout>
